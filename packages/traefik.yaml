package:
  name: traefik
  version: "3.6.4"
  epoch: 0
  description: The Cloud Native Application Proxy
  copyright:
    - license: MIT

pipeline:
  - uses: fetch
    with:
      uri: https://github.com/traefik/traefik/releases/download/v${{package.version}}/traefik-v${{package.version}}.src.tar.gz
      expected-sha256: 6c3039fa8f79b5ef77e8f3b5f94fd566a6e7a33f4783e346aeab6368b82605af

  - uses: go/build
    environment:
      CGO_ENABLED: 0
    with:
      packages: ./cmd/traefik
      output: traefik
      strip: -s -w -buildid=
      ldflags: >-
        -X github.com/traefik/traefik/v3/pkg/version.Version=${{package.version}}
        -X github.com/traefik/traefik/v3/pkg/version.BuildDate=$(date -d @"${SOURCE_DATE_EPOCH:-0}" -u '+%Y-%m-%dT%TZ')

update:
  enabled: true
  github:
    identifier: traefik/traefik
    tag-filter: v3.6.
    strip-prefix: v

test:
  pipeline:
    - runs: |
        set -o pipefail
        traefik version | grep ${{package.version}}
